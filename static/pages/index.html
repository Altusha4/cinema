<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="img-src 'self' https://image.tmdb.org https://via.placeholder.com data:;">

    <title>CinemaGo | Movie Search & Discovery</title>

    <link rel="stylesheet" href="/static/css/style.css?v=1.7">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --carousel-gap: 20px;
            --card-width: 220px;
        }

        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ä—É—Å–µ–ª—å */
        #featuredMovies {
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: nowrap !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            gap: var(--carousel-gap) !important;
            padding: 15px 5px 25px 5px !important;
            scroll-behavior: smooth !important;
            -webkit-overflow-scrolling: touch !important;
            scrollbar-width: thin;
            scrollbar-color: var(--color-dark) transparent;
            min-height: 380px;
        }

        #featuredMovies::-webkit-scrollbar { height: 8px; }
        #featuredMovies::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 10px; }
        #featuredMovies::-webkit-scrollbar-track { background: var(--color-secondary); }

        #featuredMovies > div {
            flex: 0 0 var(--card-width) !important;
            min-width: var(--card-width) !important;
            max-width: var(--card-width) !important;
            width: var(--card-width) !important;
            scroll-snap-align: start;
        }

        .featured-card {
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: #fff;
            border: 2px solid var(--color-primary);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 5px 5px 0px var(--color-primary);
        }

        .featured-card:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 8px 8px 0px var(--color-dark);
        }

        .scroll-hint {
            font-size: 0.8rem;
            color: var(--color-muted);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: bounceRight 2s infinite;
        }

        @keyframes bounceRight {
            0%, 20%, 50%, 80%, 100% {transform: translateX(0);}
            40% {transform: translateX(-5px);}
            60% {transform: translateX(-3px);}
        }

        .tag {
            background: var(--color-secondary);
            border: 2px solid var(--color-primary);
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tag:hover { background: var(--color-dark); color: white; transform: translateY(-2px); }

        .tag-outline {
            border: 1.5px solid var(--color-primary);
            padding: 4px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: var(--color-muted);
            font-weight: 700;
        }

        .skeleton-card {
            height: 330px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e6e6e6 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 20px;
            border: 2px solid var(--color-primary);
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        #movieDetails { transition: opacity 0.5s ease; }

        /* --- –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ñ–ò–í–û–ì–û –ü–û–ò–°–ö–ê --- */
        .suggestions-box {
            position: absolute;
            top: 55px;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--color-primary);
            border-radius: 15px;
            z-index: 2000;
            max-height: 350px;
            overflow-y: auto;
            box-shadow: 10px 10px 0px rgba(55, 150, 131, 0.1);
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid var(--color-secondary);
            transition: 0.2s;
        }

        .suggestion-item:hover { background: var(--color-secondary); }

        .suggestion-item img {
            width: 40px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            background: #eee;
        }

        .suggestion-info { display: flex; flex-direction: column; gap: 2px; }

        .suggestion-title { font-weight: 800; color: var(--color-dark); font-size: 0.95rem; }

        .suggestion-year { font-size: 0.8rem; color: var(--color-muted); font-weight: 600; }
    </style>
</head>
<body>
<nav class="navbar">
    <a href="/" class="logo">üé¨ CinemaGo</a>
    <div class="nav-links">
        <a href="/" class="nav-link active">Home</a>
        <a href="/pages/index.html" class="nav-link">Search</a>
        <a href="/pages/sessions.html" class="nav-link">Sessions</a>
        <a href="/pages/booking.html" class="nav-link">Booking</a>
        <a href="/pages/admin.html" class="nav-link">Admin</a>
    </div>
    <div class="auth-buttons">
        <button id="loginBtn" class="secondary" onclick="goLogin()">Login</button>
        <button id="logoutBtn" class="secondary" onclick="logout()" style="display:none;">Logout</button>
    </div>
</nav>

<main class="container">
    <h1>üîé Find Your Movie</h1>

    <div class="card">
        <h3>üé¨ Film Database</h3>

        <div class="genre-tags" style="display: flex; gap: 12px; margin-bottom: 25px; flex-wrap: wrap;">
            <span class="tag" onclick="quickSearch('Inception')">üåÄ Mind-bending</span>
            <span class="tag" onclick="quickSearch('Marvel')">ü¶∏ Superheroes</span>
            <span class="tag" onclick="quickSearch('Horror')">üëª Scary</span>
            <span class="tag" onclick="quickSearch('Interstellar')">üöÄ Space</span>
            <span class="tag" onclick="quickSearch('2024')">‚ú® New</span>
        </div>

        <div class="search-container" style="position: relative;">
            <div class="filters" style="display: flex; gap: 12px; align-items: stretch;">
                <input type="text" id="movieQuery"
                       style="flex-grow: 1;"
                       placeholder="Start typing movie title..."
                       autocomplete="off"
                       onkeypress="if(event.key === 'Enter') searchMovie()">
                <button onclick="searchMovie()" class="btn-primary" style="min-width: 120px;">Search</button>
            </div>
            <div id="searchSuggestions" class="suggestions-box"></div>
        </div>

        <div id="movieDetails" class="movie-flex" style="display: none; margin-top: 35px; border-top: 3px dashed var(--color-primary); padding-top: 35px;">
            <div class="poster-side">
                <img id="moviePoster" src="" alt="Movie Poster" style="border-radius: 20px; box-shadow: 10px 10px 0px var(--color-primary);">
            </div>
            <div class="info-side">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                    <h2 id="movieTitle" style="margin: 0; font-size: 2rem;"></h2>
                    <span id="movieRating" class="status-badge" style="background: var(--color-dark); font-size: 1rem; padding: 5px 12px;">‚≠ê 0.0</span>
                </div>
                <p id="movieRelease" style="font-weight: 800; color: var(--color-muted); margin-bottom: 15px;"></p>
                <p id="movieOverview" style="font-size: 1rem; line-height: 1.7; margin-bottom: 20px;"></p>

                <div class="movie-meta" style="display: flex; gap: 12px; margin-bottom: 25px;">
                    <span id="movieId" class="tag-outline"></span>
                    <span id="movieAdult" class="tag-outline"></span>
                </div>

                <div class="action-row">
                    <button onclick="navigateTo('sessions')" class="btn-shine" style="padding: 18px 30px; font-size: 1.1rem;">üìÖ View Showtimes</button>
                </div>
            </div>
        </div>

        <details style="margin-top: 30px; cursor: pointer; border: 1px solid var(--color-primary); border-radius: 12px; padding: 10px;">
            <summary style="font-size: 0.85rem; color: var(--color-muted); font-weight: 600;">üë®‚Äçüíª Developer Tools</summary>
            <pre id="movieJson" style="font-size: 0.8rem; margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;"></pre>
        </details>

        <div id="searchPlaceholder" style="text-align: center; padding: 60px 20px; color: var(--color-muted);">
            <p style="font-size: 1.2rem; margin: 0;">Enter a keyword above to explore our cinema library.</p>
        </div>
    </div>

    <div class="card" style="overflow: hidden; border-width: 3px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; font-size: 1.5rem;">üî• Popular Now</h3>
            <div class="scroll-hint">Scroll right <span style="font-size: 1.2rem;">‚Üí</span></div>
        </div>

        <div id="featuredMovies">
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
        </div>
    </div>
</main>

<script src="/static/js/app.js?v=1.7"></script>
<script src="/static/js/navbar.js"></script>
<script src="/static/js/movies.js?v=1.7"></script>
<script>
    // --- –õ–û–ì–ò–ö–ê –ñ–ò–í–û–ì–û –ü–û–ò–°–ö–ê –° DEBOUNCE ---
    function debounce(func, timeout = 400) {
        let timer;
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => { func.apply(this, args); }, timeout);
        };
    }

    async function liveSearch(query) {
        const box = document.getElementById('searchSuggestions');
        if (query.trim().length < 2) {
            box.style.display = 'none';
            return;
        }

        try {
            const res = await fetch(`/movies?title=${encodeURIComponent(query)}`);
            if (!res.ok) return;
            const movie = await res.json();

            // –ï—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç (—Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ Go)
            if (movie && movie.title) {
                const year = movie.release_date ? movie.release_date.split('-')[0] : 'N/A';
                const poster = movie.poster_path ? `https://image.tmdb.org/t/p/w92${movie.poster_path}` : 'https://via.placeholder.com/92x138';

                box.innerHTML = `
                    <div class="suggestion-item" onclick="selectSuggestion('${movie.id}')">
                        <img src="${poster}" alt="poster">
                        <div class="suggestion-info">
                            <span class="suggestion-title">${movie.title}</span>
                            <span class="suggestion-year">‚≠ê ${movie.vote_average.toFixed(1)} | ${year}</span>
                        </div>
                    </div>
                `;
                box.style.display = 'block';
            } else {
                box.style.display = 'none';
            }
        } catch (e) {
            console.error("Live search fail:", e);
        }
    }

    function selectSuggestion(id) {
        const input = document.getElementById('movieQuery');
        input.value = id;
        document.getElementById('searchSuggestions').style.display = 'none';
        searchMovie();
    }

    document.addEventListener('DOMContentLoaded', () => {
        if (typeof loadFeaturedMovies === 'function') {
            loadFeaturedMovies();
        }

        // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∂–∏–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
        const queryInput = document.getElementById('movieQuery');
        if (queryInput) {
            const processInput = debounce((e) => liveSearch(e.target.value));
            queryInput.addEventListener('input', processInput);
        }

        // –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                document.getElementById('searchSuggestions').style.display = 'none';
            }
        });

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('id')) {
            const input = document.getElementById('movieQuery');
            input.value = urlParams.get('id');
            setTimeout(() => searchMovie(), 300);
        }
    });

    function quickSearch(query) {
        const input = document.getElementById('movieQuery');
        input.value = query;
        searchMovie();
        window.scrollTo({ top: 100, behavior: 'smooth' });
    }
</script>
</body>
</html>